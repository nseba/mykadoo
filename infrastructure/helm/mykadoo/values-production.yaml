# Production environment values for Mykadoo
# Override default values for production deployment

global:
  environment: production
  domain: mykadoo.com

# Production replica counts
replicaCount:
  web: 5
  api: 5

# Use production image tags (semantic versioning)
image:
  tag: v1.0.0 # Update with each release

# Ingress for production
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/rate-limit: "100"
  hosts:
    - host: mykadoo.com
      paths:
        - path: /
          pathType: Prefix
          service: web
    - host: www.mykadoo.com
      paths:
        - path: /
          pathType: Prefix
          service: web
    - host: api.mykadoo.com
      paths:
        - path: /
          pathType: Prefix
          service: api
  tls:
    - secretName: mykadoo-prod-tls
      hosts:
        - mykadoo.com
        - www.mykadoo.com
        - api.mykadoo.com

# Production resources with higher limits
resources:
  web:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  api:
    requests:
      memory: "1Gi"
      cpu: "1000m"
    limits:
      memory: "2Gi"
      cpu: "2000m"

# Aggressive autoscaling for production
autoscaling:
  web:
    enabled: true
    minReplicas: 5
    maxReplicas: 20
    targetCPUUtilizationPercentage: 60
    targetMemoryUtilizationPercentage: 70
  api:
    enabled: true
    minReplicas: 5
    maxReplicas: 20
    targetCPUUtilizationPercentage: 60
    targetMemoryUtilizationPercentage: 70

# Production database configuration with pgvector
postgresql:
  # Use pgvector-enabled PostgreSQL image
  image:
    registry: docker.io
    repository: pgvector/pgvector
    tag: pg16
  primary:
    # Enable pgvector extension on database initialization
    initdb:
      scripts:
        enable-pgvector.sql: |
          CREATE EXTENSION IF NOT EXISTS vector;
    persistence:
      enabled: true
      size: 100Gi
      storageClass: "ssd" # Use fast storage
    resources:
      requests:
        memory: "2Gi"
        cpu: "2000m"
      limits:
        memory: "4Gi"
        cpu: "4000m"
  readReplicas:
    replicaCount: 2
    persistence:
      enabled: true
      size: 100Gi
    resources:
      requests:
        memory: "2Gi"
        cpu: "2000m"
      limits:
        memory: "4Gi"
        cpu: "4000m"

# pgvector configuration for production
pgvector:
  enabled: true
  dimensions: 1536
  indexType: hnsw
  # Production-optimized HNSW parameters
  hnsw:
    m: 32  # More connections for production (better accuracy)
    efConstruction: 128  # Higher build quality for production

# Production Redis configuration
redis:
  master:
    persistence:
      enabled: true
      size: 20Gi
      storageClass: "ssd"
    resources:
      requests:
        memory: "512Mi"
        cpu: "500m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
  replica:
    replicaCount: 3
    persistence:
      enabled: true
      size: 20Gi
    resources:
      requests:
        memory: "512Mi"
        cpu: "500m"
      limits:
        memory: "1Gi"
        cpu: "1000m"

# Enable monitoring for production
serviceMonitor:
  enabled: true
  interval: 15s
  scrapeTimeout: 10s

# Pod disruption budget - ensure high availability
podDisruptionBudget:
  enabled: true
  minAvailable: 3

# Environment variables
env:
  NODE_ENV: production

# Production backup configuration
backup:
  enabled: true
  timezone: "UTC"

  # Use custom backup image with all required tools
  image:
    repository: ghcr.io/mykadoo/backup-tools
    tag: "1.0.0"

  # Database backup settings - more aggressive for production
  database:
    # Daily backup at 2:00 AM UTC
    schedule: "0 2 * * *"
    type: full
    retentionDays: 90  # 90 days retention for production

  # Backup verification - weekly
  verification:
    schedule: "0 3 * * 0"

  # S3 storage configuration
  s3:
    bucket: "mykadoo-production-backups"
    prefix: "database"
    region: "us-east-1"

  # Encryption enabled for production
  encryption:
    enabled: true

  # Slack notifications enabled
  notifications:
    slack:
      enabled: true

  # More resources for production backups
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
