{
  "permissions": {
    "allow": [
      "Bash(yarn lint:*)",
      "Bash(yarn nx run-many:*)",
      "Bash(mkdir:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(tee:*)",
      "Bash(yarn install:*)",
      "Bash(node -e:*)",
      "Bash(git reset:*)",
      "Skill(execute-tasks)",
      "Bash(find:*)",
      "Bash(cat:*)",
      "Bash(yarn nx lint:*)",
      "Bash(yarn nx test:*)",
      "Bash(yarn nx build:*)",
      "Bash(yarn tsc:*)",
      "Bash(grep:*)",
      "Bash(yarn audit:*)",
      "Bash(yarn nx build-all:*)",
      "Bash(make build-all:*)",
      "Bash(tree:*)",
      "Bash(python3:*)",
      "Bash(git push)",
      "Bash(make lint-all:*)",
      "Bash(make test-all:*)",
      "Bash(git checkout:*)",
      "Bash(node test-parse.js)",
      "mcp__browser__browser_navigate",
      "mcp__browser__browser_click",
      "mcp__browser__browser_get_markdown",
      "Bash(yarn info:*)",
      "Bash(yarn add:*)",
      "Bash(yarn remove:*)",
      "Bash(yarn list:*)",
      "Bash(yarn nx reset:*)",
      "Bash(yarn nx run:*)",
      "WebFetch(domain:platform.claude.com)",
      "WebFetch(domain:github.com)",
      "Bash(node /tmp/test-markdown-strip.js:*)",
      "Bash(node:*)",
      "mcp__sequential-thinking__sequentialthinking",
      "WebFetch(domain:docs.logiccloud.io)",
      "Bash(git restore:*)",
      "Bash(yarn build)",
      "Bash(yarn dev:*)",
      "Bash(echo $ANTHROPIC_API_KEY:0:10...)",
      "Bash(timeout 120 yarn dev:*)",
      "Bash(timeout 180 yarn dev:*)",
      "Bash(apps/project-assistant-service/src/app/services/access-variable-name-generator.spec.ts)",
      "Bash(apps/project-assistant-service/src/app/ai/lib/hmi-plan-converter.spec.ts)",
      "Bash(apps/project-assistant-service/src/app/services/hmi-variable-extractor.spec.ts)",
      "Bash(git log:*)",
      "WebFetch(domain:www.claude.com)",
      "Skill(create-prd)",
      "Bash(ls:*)",
      "Skill(generate-tasks)",
      "Bash(npx --version:*)",
      "Bash(npx create-nx-workspace@latest:*)",
      "Bash(npx nx g:*)",
      "Bash(helm version:*)",
      "Bash(helm lint:*)",
      "Bash(timeout 30 yarn storybook:*)",
      "Bash(yarn nx show:*)",
      "Bash(test:*)",
      "Bash(yarn prisma generate:*)",
      "Bash(docker:*)",
      "Bash(docker-compose:*)",
      "Bash(/dev/null <<'ENDOFDOC'\n# Testing Guide\n\nComprehensive guide for writing and running tests in the Mykadoo monorepo.\n\n## Overview\n\nWe use a multi-layered testing approach:\n- **Unit Tests**: Jest + React Testing Library\n- **Integration Tests**: Supertest + TestContainers\n- **E2E Tests**: Playwright\n- **Visual Regression**: Percy (optional)\n- **Accessibility**: jest-axe\n\n## Quick Start\n\n```bash\n# Run all tests\nyarn test\n\n# Run tests for specific project\nyarn nx test web\nyarn nx test api\n\n# Run with coverage\nyarn nx test web --coverage\n\n# Watch mode\nyarn nx test web --watch\n\n# E2E tests\nyarn nx e2e web-e2e\n```\n\n## Unit Testing\n\n### React Components\n\n```typescript\nimport { render, screen, userEvent } from '@/test/utils/render';\nimport { Button } from './Button';\n\ndescribe('Button', () => {\n  it('renders with text', () => {\n    render(<Button>Click me</Button>);\n    expect(screen.getByText('Click me')).toBeInTheDocument();\n  });\n\n  it('handles click events', async () => {\n    const handleClick = jest.fn();\n    const { user } = renderWithUserEvent(\n      <Button onClick={handleClick}>Click me</Button>\n    );\n    \n    await user.click(screen.getByText('Click me'));\n    expect(handleClick).toHaveBeenCalledTimes(1);\n  });\n\n  it('is accessible', async () => {\n    const { container } = render(<Button>Click me</Button>);\n    const results = await axe(container);\n    expect(results).toHaveNoViolations();\n  });\n});\n```\n\n### NestJS Services\n\n```typescript\nimport { Test } from '@nestjs/testing';\nimport { SearchService } from './search.service';\n\ndescribe('SearchService', () => {\n  let service: SearchService;\n\n  beforeEach(async () => {\n    const module = await Test.createTestingModule({\n      providers: [SearchService],\n    }).compile();\n\n    service = module.get<SearchService>(SearchService);\n  });\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  it('should search for gifts', async () => {\n    const result = await service.search({\n      occasion: 'birthday',\n      budgetMin: 50,\n      budgetMax: 100,\n    });\n\n    expect(result.recommendations).toHaveLength(10);\n  });\n});\n```\n\n## Integration Testing\n\n### API Endpoints\n\n```typescript\nimport { INestApplication } from '@nestjs/common';\nimport { createTestApp, api, expectResponse } from '@/test/utils/api';\nimport { AppModule } from './app.module';\n\ndescribe('SearchController (e2e)', () => {\n  let app: INestApplication;\n\n  beforeAll(async () => {\n    app = await createTestApp(AppModule);\n  });\n\n  afterAll(async () => {\n    await app.close();\n  });\n\n  it('POST /api/search returns recommendations', async () => {\n    const response = await api.post(app, '/api/search', {\n      occasion: 'birthday',\n      relationship: 'friend',\n      budgetMin: 50,\n      budgetMax: 100,\n    });\n\n    expectResponse.success(response);\n    expect(response.body).toHaveProperty('recommendations');\n    expect(response.body.recommendations).toHaveLength(10);\n  });\n});\n```\n\n### Database Tests\n\n```typescript\nimport {\n  setupTestDatabase,\n  cleanupTestDatabase,\n  teardownTestDatabase,\n  getPrismaClient,\n} from '@/test/utils/database';\n\ndescribe('User Repository', () => {\n  beforeAll(async () => {\n    await setupTestDatabase();\n  });\n\n  afterEach(async () => {\n    await cleanupTestDatabase();\n  });\n\n  afterAll(async () => {\n    await teardownTestDatabase();\n  });\n\n  it('creates a user', async () => {\n    const prisma = getPrismaClient();\n    const user = await prisma.user.create({\n      data: {\n        email: 'test@example.com',\n        password: 'hashed',\n      },\n    });\n\n    expect(user.id).toBeDefined();\n    expect(user.email).toBe('test@example.com');\n  });\n});\n```\n\n## E2E Testing\n\n### Playwright Tests\n\n```typescript\nimport { test, expect } from '@playwright/test';\n\ntest.describe('Gift Search Flow', () => {\n  test('should search for gifts and display results', async ({ page }) => {\n    await page.goto('/');\n    \n    // Fill search form\n    await page.fill('[name=\"occasion\"]', 'birthday');\n    await page.fill('[name=\"budgetMin\"]', '50');\n    await page.fill('[name=\"budgetMax\"]', '100');\n    await page.click('button[type=\"submit\"]');\n    \n    // Wait for results\n    await page.waitForSelector('[data-testid=\"gift-card\"]');\n    \n    // Verify results\n    const giftCards = await page.locator('[data-testid=\"gift-card\"]').count();\n    expect(giftCards).toBeGreaterThan(0);\n  });\n\n  test('should handle authentication flow', async ({ page }) => {\n    await page.goto('/login');\n    \n    await page.fill('[name=\"email\"]', 'test@example.com');\n    await page.fill('[name=\"password\"]', 'password');\n    await page.click('button[type=\"submit\"]');\n    \n    await expect(page).toHaveURL('/dashboard');\n  });\n});\n```\n\n## Test Organization\n\n```\napps/\n  api/\n    src/\n      search/\n        search.service.ts\n        search.service.spec.ts      # Unit test\n      __tests__/\n        search.e2e.spec.ts          # Integration test\n  web/\n    src/\n      components/\n        Button/\n          Button.tsx\n          Button.spec.tsx            # Component test\n    __tests__/\n      search.e2e.spec.ts            # E2E test via API\n      \ntest/\n  utils/                             # Shared utilities\n  fixtures/                          # Test data\n  helpers/                           # Test helpers\n```\n\n## Coverage Requirements\n\nMinimum coverage thresholds (enforced):\n- **Branches**: 80%\n- **Functions**: 80%\n- **Lines**: 80%\n- **Statements**: 80%\n\nView coverage:\n```bash\nyarn test --coverage\nopen coverage/lcov-report/index.html\n```\n\n## Best Practices\n\n### 1. Arrange-Act-Assert Pattern\n\n```typescript\nit('calculates total price', () => {\n  // Arrange\n  const items = [{ price: 10 }, { price: 20 }];\n  \n  // Act\n  const total = calculateTotal(items);\n  \n  // Assert\n  expect(total).toBe(30);\n});\n```\n\n### 2. Test Naming\n\n```typescript\n// Good\nit('returns empty array when no items exist', () => {});\nit('throws error when price is negative', () => {});\n\n// Bad\nit('works', () => {});\nit('test 1', () => {});\n```\n\n### 3. Mock External Dependencies\n\n```typescript\njest.mock('./api-client', () => ({\n  fetchGifts: jest.fn(() => Promise.resolve([])),\n}));\n```\n\n### 4. Use Test IDs\n\n```typescript\n// Component\n<button data-testid=\"submit-button\">Submit</button>\n\n// Test\nscreen.getByTestId('submit-button')\n```\n\n### 5. Avoid Implementation Details\n\n```typescript\n// Good - test behavior\nexpect(screen.getByRole('button', { name: /submit/i })).toBeInTheDocument();\n\n// Bad - test implementation\nexpect(container.querySelector('.btn-submit')).toBeInTheDocument();\n```\n\n## Continuous Integration\n\nTests run automatically on:\n- Every push to main/develop\n- Every pull request\n- Before deployment\n\nCI configuration:\n```yaml\n# .github/workflows/ci.yml\n- name: Run tests\n  run: yarn nx affected --target=test --base=origin/main --coverage\n```\n\n## Debugging Tests\n\n### VS Code\n\n```json\n// .vscode/launch.json\n{\n  \"type\": \"node\",\n  \"request\": \"launch\",\n  \"name\": \"Jest Debug\",\n  \"program\": \"${workspaceFolder}/node_modules/.bin/jest\",\n  \"args\": [\"--runInBand\", \"--no-cache\", \"${file}\"],\n  \"console\": \"integratedTerminal\"\n}\n```\n\n### Chrome DevTools\n\n```bash\nnode --inspect-brk node_modules/.bin/jest --runInBand\n```\n\n## Performance\n\n- Use `jest.mock()` for external dependencies\n- Avoid unnecessary `beforeEach` setup\n- Use `test.only` to run single test during development\n- Parallel execution: `jest --maxWorkers=4`\n\n## Resources\n\n- [Jest Documentation](https://jestjs.io/docs/getting-started)\n- [React Testing Library](https://testing-library.com/react)\n- [Playwright](https://playwright.dev/)\n- [jest-axe](https://github.com/nickcolley/jest-axe)\n\nENDOFDOC)"
    ],
    "deny": [],
    "ask": []
  }
}
